Android Security Model = Multiple layers of protection

Defense in Depth approach:
├── Hardware Level
├── Kernel Level
├── OS Level
├── Application Level
└── User Level



 1. **USER LEVEL**   
     1. (Permissions, Consent) 

2. **APPLICATION LEVEL**
     1. (Sandbox, Signing, Permissions, Components)  

 3. **OS LEVEL** 
      1. (SELinux, Seccomp, ASLR, Encryption)

 4. **KERNEL LEVEL**        
       1. (Linux Kernel, Process Isolation)  

5. **HARDWARE LEVEL**    
     1. (TEE, Secure Boot, Hardware Keystore) 



## 1. Application Sandbox (Core Security)

Sandbox = Isolated environment for each app

Each app:
├── Gets unique Linux User ID (UID)
├── Runs in separate process
├── Has private data directory
├── Cannot access other apps' data

#### How UIDs Work

**SYSTEM USERS:**-

root       = UID 0
system     = UID 1000
radio      = UID 1001
bluetooth  = UID 1002


**APP USERS:-**

First app  = UID 10000 (u0_a0)
Second app = UID 10001 (u0_a1)
Third app  = UID 10002 (u0_a2)

Each app = Unique Linux user


#### Data Directory Permissions

**App private directory**
/data/data/com.example.app/
    │
    ├── Permissions: drwx------ (700)
    │   └── Only owner (app's UID) can access
    │
    ├── shared_prefs/
    ├── databases/
    ├── files/
    └── cache/

**Check permissions**
adb shell ls -la /data/data/

**Output**:
drwx------ u0_a100 u0_a100 com.app.one
drwx------ u0_a101 u0_a101 com.app.two
drwx------ u0_a102 u0_a102 com.app.three


#### Sandbox Exceptions

**WAYS TO SHARE DATA** 
1. SHARED USER ID (Same Developer)                         
    └── android:sharedUserId="com.example.shared"           
    └── Apps with same signature can share UID              
    └── Can access each other's data  


2. CONTENT PROVIDERS                                       
    └── Structured data sharing                             
    └── With permission checks  

3. EXTERNAL STORAGE                                        
    └── /sdcard/ - Any app can access                       
    └── With STORAGE permission    


4. INTENTS                                                 
    └── Message passing between apps 


 5. BOUND SERVICES                                          
    └── IPC between apps  


###  BYPASS METHODS:  SANDBOX PENTESTING  

**BYPASS METHODS:**   
 1. Root access                                              
    1. └── Full filesystem access  

 2. Debuggable app                                           
    1. └── adb run-as com.example.app

3. Backup extraction                                        
    1. └── If allowBackup="true"  

4. World-readable files                                     
    1. └── Developer mistake 

5. Content Provider vulnerabilities                         
    1. └── SQL injection, path traversal  

6. Shared UID                                               
    1. └── Install malicious app with same sharedUserId         
    2. └── (Requires same signing key)  


## 2. Permission Model

