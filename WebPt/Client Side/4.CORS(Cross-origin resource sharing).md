## SOP(Same-Origin Policy)
The ==**Same-Origin Policy (SOP)**== is a critical browser security mechanism that restricts how a document or script loaded from one origin can interact with a resource from another origin. It helps isolate potentially malicious documents, reducing possible attack vectors.

The Same-Origin Policy (SOP) is a strict **security rule inside web browsers**. It prevents a malicious website from **reading** sensitive data (like emails or profile info) from another trusted website.

*`**If there was no Same Origin Policy in place and you visit a malicious website it would be able to read all messages from your social networking account.**`*
#### **2. The "Origin" Formula**

Two URLs have the "Same Origin" only if they share the exact same:

1. **Protocol** (e.g., `http` vs `https`)
2. **Hostname** (e.g., `example.com` vs `evil.com`)
3. **Port** (e.g., `:80` vs `:8080`)
#### **3. What SOP Blocks (The "Read" Restriction)**

SOP prevents a malicious site (Attacker) from:

- Reading the **Response** of a request sent to another site.
- Reading data from the **DOM** (Document Object Model) of another site (e.g., reading text inside an iframe).
- Reading **Cookies** or Local Storage of another origin.

#### **4. How to Relax SOP?**

If two different websites _need_ to share data legitimately, they must use **CORS (Cross-Origin Resource Sharing)**. CORS is the standard way to tell the browser: _"It's okay, I trust this other origin, let them read my data."_

### ==**Ref: What happens when `evil-site` tries to `fetch` Facebook data?**==

#### **1. The Scenario**

- **User:** Logged into Facebook (Tab 1).
    
- **Attacker:** Open in Tab 2 (`evil-site.com`).
    
- **Action:** Attacker runs `fetch('https://facebook.com/friends')` with credentials (cookies) included.
    

#### **2. The Process (Step-by-Step)**

- **Step 1: Request Sent (Success âœ…)**
    
    - The browser sees the request. Since the user is logged in, the browser **automatically attaches the session cookies** and sends the request to Facebook. SOP does not stop the request from leaving.
        
- **Step 2: Server Processing (Success âœ…)**
    
    - Facebook's server receives the request.
        
    - It sees a valid cookie, so it processes the request and generates the response (The Friends List).
        
    - It sends the data back to the browser.
        
- **Step 3: Browser Verification (The Block âŒ)**
    
    - The browser receives the data.
        
    - **Before** giving the data to the attacker's JavaScript, the browser checks the **CORS Headers**.
        
    - It asks: _"Did Facebook send an `Access-Control-Allow-Origin: evil-site.com` header?"_
        
- **Step 4: The Outcome (Fail ðŸš«)**
    
    - **Answer:** No. Facebook does not allow random sites to read its data.
        
    - **Action:** The browser **discards (deletes)** the response data immediately.
        
    - **Result:** The attacker's script receives a **CORS Error** in the console. No data is stolen.
        

#### **3. Key Takeaway**

- **SOP/CORS Protection:** The browser allows the request to **GO**, but it prevents the response from being **READ**.
    
- **Difference from CSRF:** In CSRF, we want to perform an **Action** (Change Email), so we don't care if we can't read the response. But in this scenario, we wanted to **Read Data**, so the attack failed.






# ==CORS== 
(Cross-Origin Resource Sharing) is a browser mechanism that allows a server to relax the Same Origin Policy (SOP). It lets a server explicitly allow some other websites to access its resources.

**2. Key Headers**

- **Request Header:** `Origin: https://example.com` (Browser tells the server where the request is coming from).
```
GET /video-data HTTP/1.1
Host: googlevideo.com
Origin: https://www.youtube.com
```
    
- **Response Header:** `Access-Control-Allow-Origin: https://example.com` (Server tells the browser if this origin is allowed to read the data).
```
HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://www.youtube.com
```
    _(Server says: "YouTube is trusted. You can have the data.")_

**Result:** The browser allows the JavaScript to read the video data and play it.

- **Credentials Header:** `Access-Control-Allow-Credentials: true` (Required if cookies/sessions are involved).









### **Why CORS Vulnerabilities Arise?**

#### **1. The Root Cause: Over-Permissive Configuration**

The main reason this vulnerability exists is that developers configure the server to be **too friendly**. They allow "Everyone" instead of a "Selected Few."

#### **2. Specific Configuration Errors**

- **A. The "Lazy" Wildcard ==(`*`)**==
    
    - **What happens:** The developer wants the API to be public or accessible easily, so they set `Access-Control-Allow-Origin: *`.
        
    - **The Issue:** If this is combined with sensitive data, _any_ website can read it. (Though, browsers usually block `*` if `Credentials: true` is also present, developers often find workarounds that create holes).
        
- **B. The "Reflected" Origin (The Parrot Effect)**
    
    - **Why developers do it:** They want to allow multiple specific domains (e.g., `siteA.com`, `siteB.com`, `dev.siteA.com`). Instead of writing a complex list, they write a script:
        
        > _"Read the incoming `Origin` header and simply copy-paste it into the `Access-Control-Allow-Origin` response."_
        
    - **The Vulnerability:** The server blindly trusts whatever the browser sends. If an attacker sends `Origin: evil.com`, the server replies `Allowed: evil.com`. This effectively defeats the purpose of the whitelist.
        
- **C. Trusting "Null"**
    
    - **What happens:** Developers sometimes whitelist the origin `null` to support local development files or sandboxed iframes.
        
    - **The Issue:** Attackers can easily generate a `null` origin request using a sandboxed iframe (`<iframe sandbox... >`) and bypass the filter.
        
- **D. The "Credentials" Mistake**
    
    - **The Fuel:** The vulnerability becomes critical only when `Access-Control-Allow-Credentials: true` is set.
        
    - **The Error:** Developers enable this to allow cookies for login features but fail to restrict _who_ can use those cookies (by using Point B above).