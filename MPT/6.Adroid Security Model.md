Android Security Model = Multiple layers of protection

Defense in Depth approach:
â”œâ”€â”€ Hardware Level
â”œâ”€â”€ Kernel Level
â”œâ”€â”€ OS Level
â”œâ”€â”€ Application Level
â””â”€â”€ User Level



 1. **USER LEVEL**   
     1. (Permissions, Consent) 

2. **APPLICATION LEVEL**
     1. (Sandbox, Signing, Permissions, Components)  

 3. **OS LEVEL** 
      1. (SELinux, Seccomp, ASLR, Encryption)

 4. **KERNEL LEVEL**        
       1. (Linux Kernel, Process Isolation)  

5. **HARDWARE LEVEL**    
     1. (TEE, Secure Boot, Hardware Keystore) 



## 1. Application Sandbox (Core Security)

Sandbox = Isolated environment for each app

Each app:
â”œâ”€â”€ Gets unique Linux User ID (UID)
â”œâ”€â”€ Runs in separate process
â”œâ”€â”€ Has private data directory
â”œâ”€â”€ Cannot access other apps' data

#### How UIDs Work

**SYSTEM USERS:**-

root       = UID 0
system     = UID 1000
radio      = UID 1001
bluetooth  = UID 1002


**APP USERS:-**

First app  = UID 10000 (u0_a0)
Second app = UID 10001 (u0_a1)
Third app  = UID 10002 (u0_a2)

Each app = Unique Linux user


#### Data Directory Permissions

**App private directory**
/data/data/com.example.app/
    â”‚
    â”œâ”€â”€ Permissions: drwx------ (700)
    â”‚   â””â”€â”€ Only owner (app's UID) can access
    â”‚
    â”œâ”€â”€ shared_prefs/
    â”œâ”€â”€ databases/
    â”œâ”€â”€ files/
    â””â”€â”€ cache/

**Check permissions**
adb shell ls -la /data/data/

**Output**:
drwx------ u0_a100 u0_a100 com.app.one
drwx------ u0_a101 u0_a101 com.app.two
drwx------ u0_a102 u0_a102 com.app.three


#### Sandbox Exceptions

**WAYS TO SHARE DATA** 
1. SHARED USER ID (Same Developer)                         
    â””â”€â”€ android:sharedUserId="com.example.shared"           
    â””â”€â”€ Apps with same signature can share UID              
    â””â”€â”€ Can access each other's data  


2. CONTENT PROVIDERS                                       
    â””â”€â”€ Structured data sharing                             
    â””â”€â”€ With permission checks  

3. EXTERNAL STORAGE                                        
    â””â”€â”€ /sdcard/ - Any app can access                       
    â””â”€â”€ With STORAGE permission    


4. INTENTS                                                 
    â””â”€â”€ Message passing between apps 


 5. BOUND SERVICES                                          
    â””â”€â”€ IPC between apps  


###  BYPASS METHODS:  SANDBOX PENTESTING  

**BYPASS METHODS:**   
 1. Root access                                              
    1. â””â”€â”€ Full filesystem access  

 2. Debuggable app                                           
    1. â””â”€â”€ adb run-as com.example.app

3. Backup extraction                                        
    1. â””â”€â”€ If allowBackup="true"  

4. World-readable files                                     
    1. â””â”€â”€ Developer mistake 

5. Content Provider vulnerabilities                         
    1. â””â”€â”€ SQL injection, path traversal  

6. Shared UID                                               
    1. â””â”€â”€ Install malicious app with same sharedUserId         
    2. â””â”€â”€ (Requires same signing key)  


## 2. Permission Model

**Permission Architecture**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ANDROID PERMISSION MODEL                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    PERMISSION LEVELS                        â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  NORMAL          â”€â”€â–º Auto-granted at install               â”‚ â”‚
â”‚  â”‚  (Low Risk)          No user interaction needed            â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  DANGEROUS       â”€â”€â–º User must explicitly grant            â”‚ â”‚
â”‚  â”‚  (Privacy/Data)      Runtime permission (API 23+)          â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  SIGNATURE       â”€â”€â–º Granted only if apps signed           â”‚ â”‚
â”‚  â”‚  (System)            with same certificate                 â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  SIGNATURE|      â”€â”€â–º Signature OR privileged app           â”‚ â”‚
â”‚  â”‚  PRIVILEGED          (in /system/priv-app/)                â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Runtime Permission Flow (API 23+)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                RUNTIME PERMISSION FLOW                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚    â”‚ App Requests     â”‚                                         â”‚
â”‚    â”‚ Permission       â”‚                                         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚             â”‚                                                    â”‚
â”‚             â–¼                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚    â”‚ Check if Already â”‚â”€â”€â”€â”€ YES â”€â”€â”€â”€â–º Permission Granted        â”‚
â”‚    â”‚ Granted?         â”‚                                         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚             â”‚ NO                                                 â”‚
â”‚             â–¼                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚    â”‚ Show Permission  â”‚                                         â”‚
â”‚    â”‚ Dialog to User   â”‚                                         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚             â”‚                                                    â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                             â”‚
â”‚       â–¼           â–¼                                             â”‚
â”‚    ALLOW       DENY                                              â”‚
â”‚       â”‚           â”‚                                             â”‚
â”‚       â–¼           â–¼                                             â”‚
â”‚   Permission   Permission                                        â”‚
â”‚   Granted      Denied                                            â”‚
â”‚                   â”‚                                             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                        â”‚
â”‚              â–¼         â–¼                                        â”‚
â”‚         "Don't Ask   Can Ask                                    â”‚
â”‚          Again"      Again                                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```



## 3. Application Signing

All apps must be digitally signed

Identifies the developer (not trust)

Prevents unauthorized updates

ğŸ” Security issue:

Debug builds signed with default debug keys